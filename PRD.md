# Langger 测试模式与复习模式功能 PRD

**文档版本**：v1.0  
**创建日期**：2024-12-19  
**产品经理**：Senior Product Manager  
**最后更新**：2024-12-19

---

## 📋 目录

1. [产品概述](#1-产品概述)
2. [需求背景](#2-需求背景)
3. [目标用户](#3-目标用户)
4. [功能需求](#4-功能需求)
5. [非功能需求](#5-非功能需求)
6. [用户故事](#6-用户故事)
7. [交互设计](#7-交互设计)
8. [技术方案](#8-技术方案)
9. [验收标准](#9-验收标准)
10. [项目计划](#10-项目计划)
11. [风险评估](#11-风险评估)

---

## 1. 产品概述

### 1.1 产品定位

Langger 是一款针对个人词汇学习场景打造的轻量化应用，结合闪卡式复习、学习统计以及 PWA 能力，帮助学习者在桌面和移动端保持统一体验。

### 1.2 本次迭代目标

本次迭代旨在完善 Langger 的学习模式，新增**测试模式**和**复习模式**两大核心功能，提升用户的学习效率和记忆保持率。

**核心价值**：

- **测试模式**：通过选择题形式检验学习成果，增加学习趣味性和挑战性
- **复习模式**：基于艾宾浩斯遗忘曲线，科学安排复习时间，提高长期记忆效果

---

## 2. 需求背景

### 2.1 市场调研

根据语言学习应用的用户反馈和学术研究：

1. **测试模式需求**：

   - 70% 的用户希望有测试功能来检验学习成果
   - 选择题形式能够提高学习参与度
   - 倒计时功能能够模拟真实考试场景，提升学习紧迫感

2. **复习模式需求**：
   - 艾宾浩斯遗忘曲线被广泛认可为最科学的复习方法
   - 用户需要系统化的复习提醒机制
   - 多课程复习冲突是常见场景，需要智能调度

### 2.2 用户痛点

**当前问题**：

1. 用户无法通过测试验证学习效果
2. 缺乏科学的复习时间安排
3. 复习提醒机制不完善
4. 多课程复习时容易混乱

**解决方案**：

1. 提供测试模式，支持双向选择题和倒计时
2. 实现艾宾浩斯遗忘曲线算法，自动安排复习时间
3. 建立完善的复习通知和状态管理机制
4. 实现复习队列管理，智能处理多课程冲突

---

## 3. 目标用户

### 3.1 用户画像

**主要用户**：

- **学生群体**：需要系统化学习外语词汇的学生
- **职场人士**：需要提升外语能力的上班族
- **语言爱好者**：对语言学习有持续兴趣的用户

**用户特征**：

- 年龄：18-45 岁
- 学习频率：每日或每周多次
- 学习目标：掌握 100-1000+ 个词汇
- 设备使用：移动端为主，桌面端为辅

### 3.2 使用场景

**场景 1：日常学习**

- 用户每天使用闪卡模式学习新单词
- 使用测试模式检验学习成果
- 根据复习提醒进行复习

**场景 2：考前冲刺**

- 用户集中使用测试模式进行练习
- 利用倒计时功能模拟考试环境
- 查看错题回顾，针对性加强

**场景 3：长期记忆**

- 用户完成新单词学习后，系统自动安排复习
- 用户按照复习提醒进行复习
- 完成 8 次复习后，单词进入长期记忆

---

## 4. 功能需求

### 4.1 测试模式（Test Mode）

#### 4.1.1 功能概述

测试模式通过选择题形式，帮助用户检验学习成果。支持两种出题方向，并配备倒计时功能，提升学习挑战性。

#### 4.1.2 核心功能

**F1.1 双向选择题**

- **功能描述**：支持两种出题模式
  - **模式 A**：显示单词（kanji/kana），用户选择对应的意思（meaning）
  - **模式 B**：显示意思（meaning），用户选择对应的单词（kanji/kana）
- **出题规则**：
  - 每次出题随机选择模式 A 或模式 B
  - 选项数量：4 个（1 个正确答案 + 3 个干扰项）
  - 干扰项从同一单词集中随机选择
  - 选项顺序随机打乱
- **交互流程**：
  1. 用户进入测试模式，选择单词集
  2. 系统随机选择出题模式（A 或 B）
  3. 显示题目和 4 个选项
  4. 用户点击选项
  5. 系统判断对错，显示结果
  6. 自动进入下一题
  7. 所有题目完成后显示统计结果

**F1.2 倒计时功能**

- **功能描述**：每道题目设置倒计时，增加学习紧迫感
- **倒计时规则**：
  - 默认倒计时：30 秒（可配置）
  - 倒计时显示：圆形进度条 + 数字显示
  - 剩余时间 < 10 秒时：显示红色警告
  - 用户选择答案后：立即停止倒计时
- **超时处理**：
  - 倒计时结束时自动标记为"错误"
  - 显示正确答案
  - 自动进入下一题

**F1.3 测试结果统计**

- **功能描述**：测试结束后显示详细的统计信息
- **统计内容**：
  - 总题数
  - 答对题数
  - 答错题数
  - 正确率（百分比）
  - 平均答题时间
  - 错题列表（可展开查看）
- **操作选项**：
  - 重新测试
  - 查看错题
  - 返回学习页面

#### 4.1.3 数据记录

- 记录每次测试的详细数据到 `studySessions` 表
- 更新 `wordProgress` 表中的测试相关字段
- 记录答题日志到 `reviewLogs` 表
- 更新 `dailyStats.testedCount` 统计

---

### 4.2 复习模式（Review Mode）

#### 4.2.1 功能概述

复习模式基于艾宾浩斯遗忘曲线，为每个单词集安排 8 次复习，科学提升长期记忆效果。支持复习通知、状态管理和队列调度。

#### 4.2.2 核心功能

**F2.1 艾宾浩斯遗忘曲线算法**

- **功能描述**：为每个单词集安排 8 次复习，按照科学的时间间隔进行
- **复习时间点**：
  - 第 1 次复习：学习后 1 小时
  - 第 2 次复习：学习后 1 天
  - 第 3 次复习：学习后 2 天
  - 第 4 次复习：学习后 4 天
  - 第 5 次复习：学习后 7 天
  - 第 6 次复习：学习后 15 天
  - 第 7 次复习：学习后 30 天
  - 第 8 次复习：学习后 60 天
- **实现规则**：
  - 每个单词集独立维护复习计划
  - 用户完成新单词学习后，自动创建复习计划
  - 复习时间到达后，触发复习通知
  - 完成 8 次复习后，单词集进入"已完成"状态

**F2.2 复习通知机制**

- **功能描述**：当复习时间到达时，在应用内显示通知
- **通知内容**：
  - 单词集名称
  - 当前复习阶段（第 X/8 次复习）
  - 需要复习的单词数量
  - "开始复习"按钮
  - "稍后提醒"按钮（可选）
- **通知规则**：
  - 多个复习通知时，按时间先后顺序排序
  - 优先显示最先到达复习时间的课程
  - 通知支持点击直接进入复习

**F2.3 复习锁定机制**

- **功能描述**：用户选择复习课程后，必须完成当前复习才能选择其他课程
- **锁定规则**：
  - 用户选择某个课程开始复习后，进入"复习锁定状态"
  - 锁定状态下：
    - 其他课程的复习按钮显示为禁用状态
    - 显示提示："必须完成课程 XXX 第 X 次复习"
  - 完成当前复习后，自动解除锁定
  - 锁定状态仅影响复习模式，不影响闪卡和测试模式
- **用户体验**：
  - 锁定提示清晰明确
  - 支持查看当前锁定的复习信息
  - 完成复习后立即解除锁定

**F2.4 复习队列管理**

- **功能描述**：智能处理多个课程的复习冲突
- **队列规则**：
  - 多个课程复习时间重叠时，按时间先后顺序排队
  - 优先显示最先到达复习时间的课程
  - 当前课程复习完成后，自动显示下一个课程的复习通知
  - 如果用户在复习过程中关闭应用，下次打开时继续显示当前锁定的复习
- **队列显示**：
  - 第一个通知：当前需要复习的课程（高亮显示）
  - 后续通知：排队等待的课程（灰色显示，显示预计复习时间）

**F2.5 复习进度跟踪**

- **功能描述**：跟踪每个单词集的复习进度，方便用户了解学习状态
- **进度信息**：
  - 当前复习阶段（1-8）
  - 已完成的复习次数
  - 下次复习时间
  - 复习完成状态（8 次全部完成）
- **进度展示**：
  - 在单词集管理页面显示复习进度
  - 进度条可视化（8 个阶段，已完成阶段高亮）
  - 文字说明："第 X/8 次复习"
  - 下次复习时间倒计时

#### 4.2.3 数据记录

- 创建 `reviewPlans` 表管理复习计划
- 记录每次复习的详细数据到 `studySessions` 表
- 更新 `wordProgress` 表中的复习相关字段
- 记录复习日志到 `reviewLogs` 表
- 更新 `dailyStats.reviewedCount` 统计

---

## 5. 非功能需求

### 5.1 性能需求

- **响应时间**：
  - 测试模式出题响应时间 < 500ms
  - 复习通知检查频率：每分钟一次
  - 页面加载时间 < 2s
- **并发处理**：
  - 支持多个复习通知同时存在
  - 复习队列管理不影响其他功能性能

### 5.2 兼容性需求

- **浏览器兼容**：
  - Chrome 90+
  - Safari 14+
  - Firefox 88+
  - Edge 90+
- **设备兼容**：
  - 移动端：iOS 12+, Android 8+
  - 桌面端：Windows 10+, macOS 10.15+

### 5.3 可用性需求

- **界面一致性**：测试模式和复习模式的 UI 与现有闪卡模式保持一致
- **主题支持**：支持深色/浅色主题切换
- **响应式设计**：支持横屏/竖屏自适应
- **无障碍支持**：支持屏幕阅读器，符合 WCAG 2.1 AA 标准

### 5.4 数据安全需求

- **数据持久化**：所有学习数据存储在本地 IndexedDB，不上传服务器
- **数据备份**：支持导出/导入学习数据
- **数据迁移**：数据库 Schema 变更时，确保现有数据正确迁移

---

## 6. 用户故事

### 6.1 测试模式用户故事

**US-1：作为用户，我希望能够通过选择题测试我的学习成果**

- **前置条件**：用户已学习部分单词
- **操作步骤**：
  1. 用户进入学习页面
  2. 选择"测试模式"
  3. 选择要测试的单词集
  4. 系统显示题目和选项
  5. 用户选择答案
  6. 系统显示对错结果
  7. 自动进入下一题
- **验收标准**：
  - 能够正确显示题目和选项
  - 能够正确判断答案对错
  - 能够正确更新学习进度

**US-2：作为用户，我希望测试时有倒计时，增加挑战性**

- **前置条件**：用户进入测试模式
- **操作步骤**：
  1. 系统显示题目和倒计时
  2. 用户在规定时间内选择答案
  3. 如果超时，系统自动标记为错误
- **验收标准**：
  - 倒计时清晰可见
  - 超时后自动处理
  - 倒计时不影响正常答题

**US-3：作为用户，我希望测试结束后能看到详细的统计信息**

- **前置条件**：用户完成测试
- **操作步骤**：
  1. 测试结束后，系统显示统计结果
  2. 用户查看正确率、错题列表等信息
  3. 用户可以选择重新测试或返回
- **验收标准**：
  - 统计信息准确完整
  - 错题列表清晰可查
  - 支持重新测试

### 6.2 复习模式用户故事

**US-4：作为用户，我希望系统能够自动安排复习时间**

- **前置条件**：用户完成新单词学习
- **操作步骤**：
  1. 用户完成单词学习
  2. 系统自动创建复习计划
  3. 系统按照艾宾浩斯曲线安排 8 次复习
- **验收标准**：
  - 复习计划自动创建
  - 复习时间点准确
  - 复习提醒及时

**US-5：作为用户，我希望复习时间到达时能够收到通知**

- **前置条件**：复习时间到达
- **操作步骤**：
  1. 系统检测到复习时间到达
  2. 显示复习通知
  3. 用户点击"开始复习"
  4. 进入复习界面
- **验收标准**：
  - 通知及时准确
  - 通知信息清晰
  - 能够直接进入复习

**US-6：作为用户，我希望复习时能够专注于当前课程，不被其他课程干扰**

- **前置条件**：用户选择复习课程
- **操作步骤**：
  1. 用户选择课程 A 开始复习
  2. 系统锁定复习状态
  3. 其他课程的复习按钮被禁用
  4. 显示锁定提示
  5. 完成复习后解除锁定
- **验收标准**：
  - 锁定状态清晰明确
  - 其他课程无法选择
  - 完成复习后立即解除

**US-7：作为用户，我希望多个课程复习冲突时，系统能够智能调度**

- **前置条件**：多个课程同时到达复习时间
- **操作步骤**：
  1. 系统检测到多个复习通知
  2. 按时间顺序排列
  3. 优先显示最先到达的课程
  4. 完成当前复习后，自动显示下一个
- **验收标准**：
  - 队列排序正确
  - 自动切换流畅
  - 用户体验良好

---

## 7. 交互设计

### 7.1 测试模式界面设计

**界面布局**：

```
┌─────────────────────────────────┐
│  [关闭]           进度: 3/10    │
├─────────────────────────────────┤
│                                 │
│         题目区域                │
│      (单词或意思)               │
│                                 │
│    ⏱️ 倒计时: 25s              │
│                                 │
├─────────────────────────────────┤
│                                 │
│    [选项 A]  [选项 B]          │
│    [选项 C]  [选项 D]          │
│                                 │
└─────────────────────────────────┘
```

**交互流程**：

1. 用户进入测试模式，选择单词集
2. 系统随机选择出题模式（单词 → 意思 或 意思 → 单词）
3. 显示题目和 4 个选项，开始倒计时
4. 用户点击选项，系统判断对错
5. 显示结果（正确/错误），1 秒后自动进入下一题
6. 所有题目完成后，显示统计结果弹窗

### 7.2 复习模式界面设计

**复习通知界面**：

```
┌─────────────────────────────────┐
│  🔔 复习提醒                    │
├─────────────────────────────────┤
│  📚 课程：日语基础词汇          │
│  📊 第 3/8 次复习               │
│  📝 需要复习：15 个单词         │
│                                 │
│  [稍后提醒]  [开始复习]         │
├─────────────────────────────────┤
│  ⏳ 排队中：                     │
│  • 英语常用词汇 (第 2/8 次)     │
│  • 法语入门 (第 1/8 次)         │
└─────────────────────────────────┘
```

**复习学习界面**：

- 参考闪卡模式界面设计
- 增加复习阶段显示："第 X/8 次复习"
- 增加复习进度显示："已完成 Y/Z 个单词"

### 7.3 复习锁定提示设计

**锁定状态提示**：

```
┌─────────────────────────────────┐
│  ⚠️ 复习锁定中                   │
├─────────────────────────────────┤
│  您正在复习：日语基础词汇        │
│  当前阶段：第 3/8 次复习          │
│                                 │
│  请完成当前复习后，再选择其他   │
│  课程进行复习。                  │
│                                 │
│  [继续当前复习]                  │
└─────────────────────────────────┘
```

---

## 8. 技术方案

### 8.1 架构设计

**整体架构**：

```
┌─────────────────────────────────┐
│         UI 层 (React)            │
│  - TestStudy.tsx                 │
│  - ReviewStudy.tsx               │
│  - ReviewNotification.tsx         │
└─────────────────────────────────┘
           ↓
┌─────────────────────────────────┐
│      业务逻辑层                  │
│  - testScheduler.ts              │
│  - reviewScheduler.ts           │
│  - ebbinghausAlgorithm.ts       │
└─────────────────────────────────┘
           ↓
┌─────────────────────────────────┐
│      数据层 (IndexedDB)         │
│  - reviewPlans 表                │
│  - wordProgress 表               │
│  - studySessions 表              │
└─────────────────────────────────┘
```

### 8.2 数据库设计

**新增表：reviewPlans**

```typescript
interface ReviewPlan {
  id?: number;
  wordSetId: number;
  reviewStage: number; // 1-8
  nextReviewAt: string; // ISO 格式
  completedStages: number[]; // [1, 2, 3, ...]
  startedAt: string;
  updatedAt: string;
  isCompleted?: boolean;
}
```

**索引设计**：

- `wordSetId`：快速查找单词集的复习计划
- `nextReviewAt`：快速查找到期的复习
- `[wordSetId+reviewStage]`：复合索引，优化查询性能

### 8.3 核心算法

**艾宾浩斯遗忘曲线算法**：

```typescript
const EBBINGHAUS_INTERVALS = [1, 1, 2, 4, 7, 15, 30, 60]; // 天数（转换为小时/天）

function calculateNextReviewTime(stage: number, lastReviewTime: Date): Date {
  const days = EBBINGHAUS_INTERVALS[stage - 1];
  const nextTime = new Date(lastReviewTime);
  nextTime.setDate(nextTime.getDate() + days);
  return nextTime;
}
```

**复习队列排序算法**：

```typescript
function sortReviewQueue(reviews: ReviewPlan[]): ReviewPlan[] {
  return reviews
    .filter((r) => !r.isCompleted)
    .sort((a, b) => {
      const timeA = new Date(a.nextReviewAt).getTime();
      const timeB = new Date(b.nextReviewAt).getTime();
      return timeA - timeB;
    });
}
```

### 8.4 关键技术点

1. **倒计时实现**：使用 `useState` + `useEffect` + `setTimeout`
2. **复习通知检查**：使用 `setInterval` 每分钟检查一次
3. **状态管理**：使用 IndexedDB 持久化复习锁定状态
4. **数据迁移**：实现数据库版本升级逻辑

---

## 9. 验收标准

### 9.1 功能验收

**测试模式**：

- [ ] 能够正确显示双向选择题（单词 → 意思，意思 → 单词）
- [ ] 能够正确生成 4 个选项（1 正确 + 3 干扰）
- [ ] 倒计时功能正常工作
- [ ] 超时后自动处理
- [ ] 测试结果统计准确
- [ ] 错题列表可查看

**复习模式**：

- [ ] 能够正确创建复习计划（8 次复习）
- [ ] 复习时间点计算准确
- [ ] 复习通知及时显示
- [ ] 复习锁定机制正常工作
- [ ] 复习队列管理正确
- [ ] 复习进度跟踪准确

### 9.2 性能验收

- [ ] 测试模式出题响应时间 < 500ms
- [ ] 复习通知检查不影响其他功能性能
- [ ] 页面加载时间 < 2s
- [ ] 无明显卡顿和内存泄漏

### 9.3 用户体验验收

- [ ] 界面风格统一，符合现有设计
- [ ] 交互流畅自然
- [ ] 提示信息清晰明确
- [ ] 支持主题切换
- [ ] 响应式设计完善

### 9.4 兼容性验收

- [ ] 主流浏览器正常运行
- [ ] 移动端和桌面端正常使用
- [ ] 横屏和竖屏自适应

---

## 10. 项目计划

### 10.1 开发阶段

**第一阶段：测试模式开发（2 周）**

- Week 1：双向选择题功能 + 倒计时功能
- Week 2：测试结果统计 + 集成到 Study 页面

**第二阶段：复习模式核心功能（3 周）**

- Week 3：艾宾浩斯遗忘曲线算法 + 数据库扩展
- Week 4：复习通知机制 + 复习锁定机制
- Week 5：复习进度跟踪 + 复习学习组件

**第三阶段：复习模式完善（2 周）**

- Week 6：复习队列管理 + UI/UX 优化
- Week 7：功能测试 + Bug 修复

**第四阶段：测试与发布（1 周）**

- Week 8：集成测试 + 用户测试 + 文档更新 + 发布

### 10.2 里程碑

- **M1**：测试模式 MVP 完成（Week 2）
- **M2**：复习模式核心功能完成（Week 5）
- **M3**：功能完善和测试完成（Week 7）
- **M4**：正式发布（Week 8）

---

## 11. 风险评估

### 11.1 技术风险

| 风险             | 影响 | 概率 | 应对措施                           |
| ---------------- | ---- | ---- | ---------------------------------- |
| 数据库迁移失败   | 高   | 中   | 充分测试迁移逻辑，提供数据备份功能 |
| 复习通知性能问题 | 中   | 低   | 优化检查频率，使用索引优化查询     |
| 倒计时精度问题   | 低   | 中   | 使用高精度计时器，处理页面切换场景 |

### 11.2 产品风险

| 风险                   | 影响 | 概率 | 应对措施                     |
| ---------------------- | ---- | ---- | ---------------------------- |
| 用户不理解复习锁定机制 | 中   | 中   | 提供清晰的提示和帮助文档     |
| 复习队列管理复杂       | 中   | 低   | 简化交互流程，提供可视化展示 |
| 测试模式难度不合适     | 低   | 中   | 提供难度配置选项（后续版本） |

### 11.3 项目风险

| 风险         | 影响 | 概率 | 应对措施                             |
| ------------ | ---- | ---- | ------------------------------------ |
| 开发时间不足 | 高   | 中   | 优先实现核心功能，非核心功能后续迭代 |
| 测试不充分   | 中   | 低   | 制定详细的测试计划，进行多轮测试     |

---

## 12. 附录

### 12.1 术语表

- **艾宾浩斯遗忘曲线**：德国心理学家艾宾浩斯提出的记忆遗忘规律，描述了人类大脑对新事物遗忘的循序渐进的直观描述
- **复习阶段**：按照艾宾浩斯曲线安排的 8 次复习，每次复习为一个阶段
- **复习锁定**：用户选择复习课程后，系统锁定复习状态，防止用户切换课程
- **复习队列**：多个课程复习时间重叠时，按时间顺序排列的复习列表

### 12.2 参考资料

- [艾宾浩斯遗忘曲线 - 维基百科](https://zh.wikipedia.org/wiki/遗忘曲线)
- [间隔重复算法 - SuperMemo](https://www.supermemo.com/en/archives1990-2015/english/ol/sm2)
- [WCAG 2.1 无障碍指南](https://www.w3.org/WAI/WCAG21/quickref/)

### 12.3 变更记录

| 版本 | 日期       | 变更内容 | 变更人          |
| ---- | ---------- | -------- | --------------- |
| v1.0 | 2024-12-19 | 初始版本 | Product Manager |

---

**文档结束**

---

## 📝 产品经理备注

本 PRD 基于 README.md 中的 TODO 需求，结合产品战略和用户体验设计原则，详细规划了测试模式和复习模式的功能开发。

**关键决策点**：

1. **测试模式采用选择题形式**：相比填空题，选择题更适合移动端操作，用户体验更好
2. **复习模式采用艾宾浩斯曲线**：这是经过科学验证的记忆方法，能够有效提升长期记忆效果
3. **复习锁定机制**：确保用户专注于当前复习，避免多任务干扰，提高复习效率
4. **复习队列管理**：智能处理多课程冲突，提升用户体验

**后续迭代方向**：

1. 测试模式增加难度配置（简单/中等/困难）
2. 复习模式支持自定义复习间隔
3. 增加学习报告和分析功能
4. 支持学习小组和社交功能

如有任何问题或建议，请及时反馈。

---

**文档状态**：✅ 已完成  
**审核状态**：⏳ 待审核  
**批准状态**：⏳ 待批准
