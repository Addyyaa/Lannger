# 工单 TICKET-006

**创建时间**：2024-12-19 18:00  
**创建者**：产品经理专家  
**分配给**：编程专家  
**状态**：待处理  
**优先级**：P1

## 工单描述

实现数据导出/导入功能的增强，支持按单词集选择性导入，提升用户数据迁移和备份的灵活性。

## 产品价值分析

### 用户是谁？TA 真正痛苦的是什么？

**目标用户**：

- 多设备用户：需要在不同设备间同步学习数据
- 数据迁移用户：更换设备或清理数据时需要备份
- 选择性导入用户：只想导入部分单词集，避免覆盖现有数据

**用户痛点**：

1. 当前导入功能是全量导入，无法选择特定单词集
2. 导入时会覆盖现有数据，用户担心数据丢失
3. 无法合并多个备份文件的数据

### 市场天花板与付费意愿

- **市场天花板**：高（100% 用户都需要数据备份能力）
- **付费意愿**：中等（基础功能，但能显著提升用户粘性和信任度）
- **竞品对比**：Anki、Quizlet 都支持选择性导入，这是行业标准功能

### MVP 边界

**核心功能**：

1. 导出时支持选择单词集（多选）
2. 导入时显示单词集列表，支持勾选导入
3. 导入冲突处理：同名单词集提示覆盖/跳过/重命名
4. 导入进度显示和错误提示

**非 MVP 功能**（后续迭代）：

- 自动合并重复单词
- 导入预览功能
- 批量导入多个文件

### 北极星指标

- **7 天验证指标**：
  - 用户备份率：从当前 X% 提升到 Y%（目标：提升 30%）
  - 导入成功率：> 95%
  - 导入操作平均时长：< 30 秒

### 竞品降维打击点

- **Anki**：导入流程复杂，需要手动配置
- **Quizlet**：不支持选择性导入
- **我们的优势**：一键选择，可视化预览，智能冲突处理

## 详细需求

### 功能要求

1. **选择性导出功能**

   - 在导出界面显示所有单词集列表（多选框）
   - 支持全选/反选
   - 导出文件包含选中的单词集及其单词
   - 导出文件格式保持兼容（JSON）

2. **选择性导入功能**

   - 导入时解析文件，显示所有可导入的单词集
   - 每个单词集显示：名称、单词数量、是否已存在
   - 支持勾选要导入的单词集（默认全选）
   - 支持全选/反选操作

3. **冲突处理机制**

   - 检测同名单词集
   - 提供三种处理方式：
     - **覆盖**：替换现有单词集
     - **跳过**：保留现有，不导入
     - **重命名**：导入为新单词集（自动添加后缀，如"单词集名称\_1"）
   - 默认策略：重命名（最安全）

4. **导入进度与反馈**

   - 显示导入进度条（0-100%）
   - 显示当前导入的单词集名称
   - 导入完成后显示统计信息：
     - 成功导入的单词集数量
     - 成功导入的单词数量
     - 跳过的单词集数量
     - 重命名的单词集数量

5. **错误处理**

   - 文件格式错误提示
   - 数据验证失败提示（如单词格式不正确）
   - 导入过程中的异常捕获和回滚机制

6. **数据备份机制**（新增）
   - 导入前自动备份当前数据库
   - 备份文件命名：`backup_before_import_YYYYMMDD_HHMMSS.json`
   - 备份失败时阻止导入操作
   - 备份成功后显示备份文件位置提示

### 技术实现要点

1. **导出功能增强**

   - 修改 `backupDatabase()` 函数，支持传入单词集 ID 列表
   - 在 UI 层添加单词集选择界面
   - 导出文件格式保持不变，确保向后兼容

2. **导入功能增强**

   - 修改 `ImportDialog.tsx`，添加单词集选择界面
   - 解析导入文件，提取单词集列表
   - 实现冲突检测和解决逻辑
   - 批量导入选中的单词集

3. **数据完整性**
   - 导入前验证数据格式
   - 导入过程中使用事务确保原子性
   - 导入失败时回滚，不影响现有数据

## 验收标准

- [ ] 导出功能支持选择单词集（多选）
- [ ] 导出文件格式正确，包含选中的单词集和单词
- [ ] 导入界面显示所有可导入的单词集列表
- [ ] 支持勾选/取消勾选单词集
- [ ] 冲突检测正确识别同名单词集
- [ ] 冲突处理三种方式（覆盖/跳过/重命名）正常工作
- [ ] 导入进度条正确显示进度
- [ ] 导入完成后显示准确的统计信息
- [ ] 错误处理机制完善，异常情况有明确提示
- [ ] 导入失败时不影响现有数据（回滚机制）
- [ ] 导入前自动备份当前数据库
- [ ] 备份失败时阻止导入操作
- [ ] 边界测试场景通过（超大文件、异常格式、空文件、特殊字符、1000+单词集）

## 预计工时

8 小时

## 测试场景补充

### 边界测试场景

- [ ] 超大文件导入（> 10MB）
- [ ] 异常格式文件（损坏的 JSON）
- [ ] 空文件导入
- [ ] 包含特殊字符的单词集名称
- [ ] 导入包含 1000+ 单词集的文件
- [ ] 导入包含 10000+ 单词的文件
- [ ] 并发导入测试（快速连续点击导入按钮）

## 依赖关系

- **无前置依赖**：可独立开发
- **建议执行顺序**：第 1 个执行（用户价值高，无技术依赖）

## 相关文件

- `src/services/wordService.ts`（backupDatabase/restoreDatabase 函数）
- `src/components/ImportDialog.tsx`（导入组件）
- `src/pages/Manage.tsx`（管理页面，导出按钮）
- `src/components/RestoreData.tsx`（恢复数据组件）

## 产品经理备注

**优先级调整理由**：

- 从 P2 提升到 P1，因为这是用户数据安全的基础能力
- 直接影响用户信任度和产品留存率
- 竞品都有此功能，缺失会影响竞争力

**后续迭代方向**：

1. 支持导入预览（导入前查看数据）
2. 支持自动合并重复单词
3. 支持增量导入（只导入新增/修改的单词）

---

**创建者**：产品经理专家  
**审核状态**：⏳ 待审核
