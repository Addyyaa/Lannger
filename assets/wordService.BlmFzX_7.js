import{e as D,d as i,D as c,a as f}from"./index.-GvUaqiA.js";async function h(n){await D();let r,u=!1;Array.isArray(n)?r=n:n&&(r=n.selectedWordSetIds,u=n.includeProgress||!1);const w=await i.wordSets.toArray();let S;r&&r.length>0?S=w.filter(e=>r.includes(e.id)&&e.id!==c&&e.name!==f):S=w.filter(e=>e.id!==c&&e.name!==f);const g=new Set(S.map(e=>e.id)),I=(await i.words.toArray()).filter(e=>e.setId===void 0||e.setId===null?!1:g.has(e.setId)||e.setId===c&&(!r||r.includes(c))),m=new Set(I.map(e=>e.id)),y=I.map(e=>{if(e.setId===c){const{setId:a,...s}=e;return{...s,wordSet:f}}const d=w.find(a=>a.id===e.setId);if(d){const{setId:a,...s}=e;return{...s,wordSet:d.name}}const{setId:l,...t}=e;return{...t,wordSet:f}}),o={wordSets:S,words:y};if(u){const e=await i.wordProgress.toArray();o.wordProgress=e.filter(t=>m.has(t.wordId)).map(t=>{const a=I.find(s=>s.id===t.wordId);return{...t,wordKanji:a?.kanji,wordKana:a?.kana}});const d=await i.reviewPlans.toArray();o.reviewPlans=d.filter(t=>g.has(t.wordSetId)).map(t=>{const a=w.find(s=>s.id===t.wordSetId);return{...t,wordSetName:a?.name}});const l=await i.dailyStats.toArray();o.dailyStats=l}if(!r||r.length===0){const e=JSON.stringify(o,null,2),d=new Blob([e],{type:"application/json"}),l=URL.createObjectURL(d),t=document.createElement("a");t.href=l,t.download="langggerDB.json",t.click(),URL.revokeObjectURL(l)}return o}export{h as backupDatabase};
